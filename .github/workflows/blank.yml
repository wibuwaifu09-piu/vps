name: üöÄ SERVER vanmanhgaming

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'Th·ªùi gian s·ª≠ d·ª•ng'
        required: false
        default: '1_Gi·ªù_30_Ph√∫t_(90m)'
        type: choice
        options:
          - '30_Ph√∫t_(30m)'
          - '1_Gi·ªù_(60m)'
          - '1_Gi·ªù_30_Ph√∫t_(90m)'
          - '2_Gi·ªù_(120m)'
          - '2_Gi·ªù_30_Ph√∫t_(150m)'
          - '3_Gi·ªù_(180m)'
          - '3_Gi·ªù_30_Ph√∫t_(210m)'
          - '4_Gi·ªù_(240m)'
          - '4_Gi·ªù_30_Ph√∫t_(270m)'
          - '5_Gi·ªù_(300m)'
          - '5_Gi·ªù_30_Ph√∫t_(330m)'
          - '6_Gi·ªù_(360m)'

jobs:
  Vanmanhgaming-RDP-Setup:
    runs-on: windows-latest
    steps:
      # BANNER CH√ÄO M·ª™NG
      - name: KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG
        shell: powershell
        run: |
          [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
          $OutputEncoding = [System.Text.Encoding]::UTF8
          chcp 65001 > $null
          
          Write-Host "`n vanmanhgaming RDP SERVER" -ForegroundColor Yellow
          Write-Host " Powered by vanmanhgaming" -ForegroundColor Green
          Write-Host " Th·ªùi gian: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta

      # C·∫§U H√åNH H·ªÜ TH·ªêNG
      - name: C·∫§U H√åNH H·ªÜ TH·ªêNG
        shell: powershell
        run: |
          [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
          netsh advfirewall firewall add rule name="RDP-Premium" dir=in action=allow protocol=TCP localport=3389
          netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389
          Set-Service -Name TermService -StartupType Automatic
          Start-Service TermService
          Write-Host " C·∫•u h√¨nh RDP ho√†n t·∫•t" -ForegroundColor Green

      # T·∫†O USER PREMIUM - (m·∫≠t kh·∫©u c·ªë ƒë·ªãnh)
      - name: üë§ T·∫†O T√ÄI KHO·∫¢N PREMIUM
        shell: pwsh
        run: |
          Write-Host ""
          Write-Host "üë§ ƒêANG T·∫†O T√ÄI KHO·∫¢N vanmanhgaming" -ForegroundColor Yellow

          Write-Host ""
          Write-Host "üîê ƒêANG ƒê·∫∂T M·∫¨T KH·∫®U" -ForegroundColor Yellow

          # M·∫≠t kh·∫©u c·ªë ƒë·ªãnh
          $matKhau = "@vanmanh2K9"
          $securePass = ConvertTo-SecureString $matKhau -AsPlainText -Force

          # X√≥a user c≈© n·∫øu t·ªìn t·∫°i
          try {
              Remove-LocalUser -Name "vanmanhgaming" -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ ƒê√£ x√≥a user c≈©" -ForegroundColor Green
              Start-Sleep -Seconds 2
          } catch {
              Write-Host "‚îÇ ‚ÑπÔ∏è  Kh√¥ng c√≥ user c≈© ƒë·ªÉ x√≥a" -ForegroundColor Blue
          }

          # T·∫°o user m·ªõi v·ªõi ƒë·∫ßy ƒë·ªß quy·ªÅn
          try {
              New-LocalUser `
                  -Name "vanmanhgaming" `
                  -Password $securePass `
                  -FullName "vanmanhgaming Premium" `
                  -Description "vanmanhgaming Premium Account" `
                  -AccountNeverExpires `
                  -ErrorAction Stop

              Write-Host "‚îÇ ‚úÖ ƒê√£ t·∫°o user m·ªõi" -ForegroundColor Green
              Start-Sleep -Seconds 1

              # ƒê·∫∑t password kh√¥ng bao gi·ªù h·∫øt h·∫°n
              Set-LocalUser -Name "vanmanhgaming" -PasswordNeverExpires $true -ErrorAction SilentlyContinue

              # Th√™m v√†o c√°c nh√≥m c·∫ßn thi·∫øt
              Add-LocalGroupMember -Group "Administrators" -Member "vanmanhgaming" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Remote Desktop Users" -Member "vanmanhgaming" -ErrorAction SilentlyContinue

              # K√≠ch ho·∫°t user
              Enable-LocalUser -Name "vanmanhgaming" -ErrorAction SilentlyContinue

              Write-Host "‚îÇ ‚úÖ ƒê√£ c·∫•p quy·ªÅn Administrator & RDP" -ForegroundColor Green

          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói t·∫°o user: $($_.Exception.Message)" -ForegroundColor Red
              exit 1
          }

          # L∆∞u th√¥ng tin
          echo "RDP_USER=vanmanhgaming" >> $env:GITHUB_ENV
          echo "RDP_PASS=$matKhau" >> $env:GITHUB_ENV
          echo "$matKhau" > $env:TEMP\rdp_password.txt

          Write-Host "‚úÖ T√†i kho·∫£n: vanmanhgaming ƒë√£ s·∫µn s√†ng" -ForegroundColor Green

      # TAILSCALE PREMIUM
      - name: üåê THI·∫æT L·∫¨P M·∫†NG PREMIUM
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          Write-Host ""
          Write-Host "üåê ƒêANG THI·∫æT L·∫¨P K·∫æT N·ªêI M·∫†NG" -ForegroundColor Yellow
          
          # C√†i ƒë·∫∑t Tailscale
          try {
              $msiPath = "$env:TEMP\tailscale-premium.msi"
              Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
              Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
              Remove-Item $msiPath -Force -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ C√†i ƒë·∫∑t Tailscale th√†nh c√¥ng" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói c√†i ƒë·∫∑t Tailscale" -ForegroundColor Red
          }
          
          # Ch·ªù d·ªãch v·ª• kh·ªüi ƒë·ªông
          Start-Sleep -Seconds 10
          
          # K·∫øt n·ªëi Tailscale
          try {
              & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=vanmanhgaming-premium-$env:GITHUB_RUN_ID --accept-routes --accept-dns --reset
              Write-Host "‚îÇ ‚úÖ K·∫øt n·ªëi Tailscale th√†nh c√¥ng" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói k·∫øt n·ªëi Tailscale" -ForegroundColor Red
          }
          
          # L·∫•y IP v·ªõi retry mechanism
          Write-Host "üîÑ ƒêang l·∫•y ƒë·ªãa ch·ªâ IP..." -NoNewline -ForegroundColor Blue
          $ip = $null
          for($i=0; $i -lt 20; $i++) {
              try {
                  $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4 2>&1
                  if ($ip -and $ip -match '^\d+\.\d+\.\d+\.\d+$') {
                      echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV
                      Write-Host "`r‚úÖ ƒê·ªãa ch·ªâ IP: $ip" -ForegroundColor Green
                      break
                  }
              } catch {
                  # B·ªè qua l·ªói v√† th·ª≠ l·∫°i
              }
              Write-Host "`rüîÑ ƒêang l·∫•y ƒë·ªãa ch·ªâ IP... $(@('.', '..', '...')[$i % 3])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Seconds 3
          }
          
          if (-not $ip -or $ip -notmatch '^\d+\.\d+\.\d+\.\d+$') {
              Write-Host "`r‚ö†Ô∏è  Kh√¥ng th·ªÉ l·∫•y IP, s·ª≠ d·ª•ng localhost" -ForegroundColor Yellow
              echo "TAILSCALE_IP=localhost" >> $env:GITHUB_ENV
          }

      - name: üåê KI·ªÇM TRA K·∫æT N·ªêI ƒê·∫æN TAILSCALE
        run: |
          # K√≠ch ho·∫°t Tailscale b·∫±ng Auth Key v√† ƒë·∫∑t t√™n m√°y theo ID c·ªßa GitHub Runner
          Write-Host "üîß ƒêang kh·ªüi t·∫°o Tailscale..."
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=gh-runner-$env:GITHUB_RUN_ID

          # Ch·ªù Tailscale c·∫•p ƒë·ªãa ch·ªâ IP
          Write-Host "‚è≥ ƒêang ch·ªù Tailscale c·∫•p IP..."
          $tsIP = $null
          $retries = 0

          while (-not $tsIP -and $retries -lt 10) {
              $tsIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
              Start-Sleep -Seconds 5
              $retries++
          }

          # N·∫øu kh√¥ng l·∫•y ƒë∆∞·ª£c ƒë·ªãa ch·ªâ IP th√¨ b√°o l·ªói v√† tho√°t
          if (-not $tsIP) {
              Write-Error "‚ùå Kh√¥ng th·ªÉ l·∫•y ƒë·ªãa ch·ªâ IP t·ª´ Tailscale. D·ª´ng ti·∫øn tr√¨nh."
              exit 1
          }

          Write-Host "‚úÖ ƒê√£ nh·∫≠n IP Tailscale: $tsIP" -ForegroundColor Green

          # Xu·∫•t IP sang bi·∫øn m√¥i tr∆∞·ªùng ƒë·ªÉ d√πng ·ªü b∆∞·ªõc ti·∫øp theo
          echo "TAILSCALE_IP=$tsIP" >> $env:GITHUB_ENV

      # KI·ªÇM TRA K·∫æT N·ªêI RDP
      - name: KI·ªÇM TRA K·∫æT N·ªêI RDP
        shell: pwsh
        run: |
          Write-Host " ƒê·ªãa ch·ªâ Tailscale: $env:TAILSCALE_IP"
          $testResult = Test-NetConnection -ComputerName $env:TAILSCALE_IP -Port 3389 -WarningAction SilentlyContinue
          if (-not $testResult.TcpTestSucceeded) {
              Write-Error " Kh√¥ng th·ªÉ k·∫øt n·ªëi TCP ƒë·∫øn c·ªïng RDP (3389)."
              exit 1
          }

     # D·ªåN D·∫∏P
      - name: üßπ D·ªåN D·∫∏P FILE T·∫†M
        if: always()
        run: |
          Remove-Item "$env:TEMP\rdp_password.txt" -Force -ErrorAction SilentlyContinue
          Write-Host "üßπ ƒê√£ d·ªçn d·∫πp file t·∫°m th√†nh c√¥ng!" -ForegroundColor Green

      # HI·ªÇN TH·ªä GIAO DI·ªÜN ƒê·∫∏P
      - name: üéâ TH√îNG TIN K·∫æT N·ªêI
        run: |
          # L·∫•y m·∫≠t kh·∫©u t·ª´ bi·∫øn m√¥i tr∆∞·ªùng (ƒë∆∞·ª£c thi·∫øt l·∫≠p trong b∆∞·ªõc t·∫°o user)
          $matKhau = $env:RDP_PASS
          if (-not $matKhau) {
              $matKhau = "Kh√¥ng th·ªÉ ƒë·ªçc m·∫≠t kh·∫©u"
          }
          
          # Chuy·ªÉn ƒë·ªïi th·ªùi gian t·ª´ input sang ph√∫t
          $durationInput = "${{ github.event.inputs.duration }}"
          switch ($durationInput) {
              "30_Ph√∫t_(30m)"              { $totalMinutes = 30;  $displayTime = "30 ph√∫t" }
              "1_Gi·ªù_(60m)"                { $totalMinutes = 60;  $displayTime = "1 gi·ªù" }
              "1_Gi·ªù_30_Ph√∫t_(90m)"        { $totalMinutes = 90;  $displayTime = "1 gi·ªù 30 ph√∫t" }
              "2_Gi·ªù_(120m)"               { $totalMinutes = 120; $displayTime = "2 gi·ªù" }
              "2_Gi·ªù_30_Ph√∫t_(150m)"       { $totalMinutes = 150; $displayTime = "2 gi·ªù 30 ph√∫t" }
              "3_Gi·ªù_(180m)"               { $totalMinutes = 180; $displayTime = "3 gi·ªù" }
              "3_Gi·ªù_30_Ph√∫t_(210m)"       { $totalMinutes = 210; $displayTime = "3 gi·ªù 30 ph√∫t" }
              "4_Gi·ªù_(240m)"               { $totalMinutes = 240; $displayTime = "4 gi·ªù" }
              "4_Gi·ªù_30_Ph√∫t_(270m)"       { $totalMinutes = 270; $displayTime = "4 gi·ªù 30 ph√∫t" }
              "5_Gi·ªù_(300m)"               { $totalMinutes = 300; $displayTime = "5 gi·ªù" }
              "5_Gi·ªù_30_Ph√∫t_(330m)"       { $totalMinutes = 330; $displayTime = "5 gi·ªù 30 ph√∫t" }
              "6_Gi·ªù_(360m)"               { $totalMinutes = 360; $displayTime = "6 gi·ªù" }
          }
          
          # T√≠nh th·ªùi gian ch√≠nh x√°c
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê" -ForegroundColor Cyan
          Write-Host "‚îÇ              üéâ K·∫æT N·ªêI TH√ÄNH C√îNG!              ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üåê  ƒê·ªãa ch·ªâ: $env:TAILSCALE_IP" -ForegroundColor White
          Write-Host "‚îÇ üë§  T√†i kho·∫£n: vanmanhgaming" -ForegroundColor White
          Write-Host "‚îÇ üîê  M·∫≠t kh·∫©u: $matKhau" -ForegroundColor White
          Write-Host "‚îÇ ‚è∞  Th·ªùi l∆∞·ª£ng: $displayTime" -ForegroundColor White
          Write-Host "‚îÇ üïê  B·∫Øt ƒë·∫ßu: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üïê  K·∫øt th√∫c: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üìç  Port: 3389" -ForegroundColor White
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üí°  H∆∞·ªõng d·∫´n:                                     ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îÇ   1. M·ªü Remote Desktop Connection                  ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   2. Nh·∫≠p: $env:TAILSCALE_IP                       ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   3. User: vanmanhgaming | Password: tr√™n          ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   4. Done VPS R·ªìi Nha C√°c T√¨nh Y√™u! üöÄ             ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò" -ForegroundColor Cyan
          
          # L∆∞u th·ªùi gian v√†o bi·∫øn m√¥i tr∆∞·ªùng
          echo "TOTAL_MINUTES=$totalMinutes" >> $env:GITHUB_ENV

        # DUY TR√å PHI√äN L√ÄM VI·ªÜC ·ªîN ƒê·ªäNH V√† 90 ng√†y / 24/7
      - name: ‚è≥ DUY TR√å PHI√äN L√ÄM VI·ªÜC
        shell: pwsh
        run: |
            $totalMinutes = [int]$env:TOTAL_MINUTES
            $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
            $startTime = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
            $endTime = $startTime.AddMinutes($totalMinutes)
            Write-Host ""
            Write-Host "üîÑ B·∫ÆT ƒê·∫¶U DUY TR√å PHI√äN L√ÄM VI·ªÜC..." -ForegroundColor Yellow
            Write-Host "üíé Phi√™n: $env:RDP_USER" -ForegroundColor Magenta
            Write-Host "üîó K·∫øt n·ªëi: $env:TAILSCALE_IP" -ForegroundColor Cyan
            Write-Host "üïê B·∫Øt ƒë·∫ßu: $($startTime.ToString('dd/MM/yyyy HH:mm:ss'))" -ForegroundColor Green
            Write-Host "üïê K·∫øt th√∫c: $($endTime.ToString('dd/MM/yyyy HH:mm:ss'))" -ForegroundColor Green
            Write-Host ""
            # Gi√°m s√°t TermService
            $monitorScript = {
                while ($true) {
                    $termService = Get-Service -Name TermService -ErrorAction SilentlyContinue
                    if ($termService.Status -ne 'Running') { Start-Service -Name TermService -ErrorAction SilentlyContinue }
                    Start-Sleep -Seconds 30
                }
            }
            Start-Job -ScriptBlock $monitorScript -Name "SystemMonitor"
            # Ki·ªÉm tra 24/7 ch·ªâ khi TOTAL_MINUTES >= 43200
            $infiniteRun = $totalMinutes -ge 43200
            do {
                $currentTime = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
                $timeLeft = $endTime - $currentTime
                $days = [math]::Max(0, [math]::Floor($timeLeft.TotalDays))
                $hours = [math]::Max(0, [math]::Floor($timeLeft.TotalHours % 24))
                $minutes = [math]::Max(0, [math]::Floor($timeLeft.TotalMinutes % 60))
                $seconds = [math]::Max(0, [math]::Floor($timeLeft.TotalSeconds % 60))
                if ($infiniteRun) {
                    Write-Host ("üü¢ Ch·∫ø ƒë·ªô 24/7 ƒëang ch·∫°y... Th·ªùi gian c√≤n l·∫°i: {0} ng√†y {1} gi·ªù {2} ph√∫t {3} gi√¢y" -f $days, $hours, $minutes, $seconds) -ForegroundColor Green
                } else {
                    Write-Host ("‚è≥ Th·ªùi gian c√≤n l·∫°i: {0} ng√†y {1} gi·ªù {2} ph√∫t {3} gi√¢y" -f $days, $hours, $minutes, $seconds) -ForegroundColor Cyan
                }
                Start-Sleep -Seconds 5
            } while ($infiniteRun -or $timeLeft.TotalSeconds -gt 0)
            Write-Host "üéØ ƒê√É H·∫æT TH·ªúI GIAN - T·ª∞ ƒê·ªòNG D·ª™NG!" -ForegroundColor Red
            # D·ªçn d·∫πp Job gi√°m s√°t
            Get-Job -Name "SystemMonitor" -ErrorAction SilentlyContinue | Stop-Job -PassThru | Remove-Job -Force

      # D·ªåN D·∫∏P CU·ªêI C√ôNG
      - name: D·ªåN D·∫∏P H·ªÜ TH·ªêNG
        if: always()
        shell: powershell
        run: |
          Write-Host ""
          Write-Host " ƒêANG D·ªåN D·∫∏P H·ªÜ TH·ªêNG..." -ForegroundColor Yellow

          try { Disable-LocalUser -Name "vanmanhgaming" -ErrorAction SilentlyContinue } catch {}

          try {
              & "$env:ProgramFiles\Tailscale\tailscale.exe" down --accept-risk=all
              Start-Sleep -Seconds 5
          } catch {}

          try {
              netsh advfirewall firewall delete rule name="RDP-Premium" 2>$null
              netsh advfirewall firewall delete rule name="RDP-Premium-Out" 2>$null
              Remove-NetFirewallRule -DisplayName "RDP-Premium" -ErrorAction SilentlyContinue
              Remove-NetFirewallRule -DisplayName "RDP-Premium-Out" -ErrorAction SilentlyContinue
          } catch {}

          try {
              Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 1 -Force
              Stop-Service -Name TermService -Force -ErrorAction SilentlyContinue
          } catch {}

          Get-Job | Stop-Job -PassThru | Remove-Job -Force -ErrorAction SilentlyContinue

          Write-Host " D·ªçn d·∫πp ho√†n t·∫•t! H·∫πn g·∫∑p l·∫°i! " -ForegroundColor Green
